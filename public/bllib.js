!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.bllib=t():e.bllib=t()}(self,(function(){return(()=>{"use strict";var e={903:(e,t,o)=>{o.d(t,{Couple:()=>a,CustomError:()=>l,KeyboardKeyCode:()=>n,_isEqual:()=>i});class r{equals(e){return this===e}}function i(e,t){if(e instanceof Array){if(!(t instanceof Array)||e.length!=t.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],t[o]))return!1;return!0}return!!Object.is(e,t)||(e instanceof r?e.equals(t):e===t)}class n{code;key;keyCode;which;constructor(e,t,o,r){this.code=e,this.key=t,this.keyCode=o,this.which=r}convertToEvent(e){let t={};for(let e in this){let o=this[e];null!=o&&(t[e]=o)}return new KeyboardEvent(e,t)}}class s extends r{#e;get size(){return this.#e.length}constructor(...e){super(),this.#e=e;for(let t=0;t<e.length;t++)Object.defineProperty(this,t,{configurable:!1,enumerable:!0,writable:!1,value:e[t]})}equals(e){if(!(e instanceof s))return!1;if(this.size!=e.size)return!1;for(let t=0;t<this.size;t++)if(!i(this[t],e[t]))return!1;return!0}}class a extends s{get 0(){return this[0]}get 1(){return this[1]}constructor(e,t){super(e,t)}equals(e){return e instanceof a&&super.equals(e)}}Map;class l extends Error{code;subErrors;errorObj;constructor(e,t,o=[],r){super(t),this.code=e,this.subErrors=o,this.errorObj=r}appendSubError(e){this.subErrors.push(e)}static#t(e){let t={code:e.code,message:e.message,subErrors:[]};return e.subErrors.length>0&&(t.subErrors=e.subErrors.map((e=>this.#t(e)))),t}toPlainObject(){return l.#t(this)}}},882:(e,t,o)=>{o.d(t,{DEFAULT_LOG_GROUP:()=>r});const r="Common"},613:(e,t,o)=>{o.d(t,{ConsoleOutputLevel:()=>i,ErrorCode:()=>n});var r=o(903);new r.KeyboardKeyCode("Space"," "),new r.KeyboardKeyCode("Enter","Enter"),new r.KeyboardKeyCode("Escape","Escape"),new r.KeyboardKeyCode("KeyA","a"),new r.KeyboardKeyCode("KeyB","b"),new r.KeyboardKeyCode("KeyC","c"),new r.KeyboardKeyCode("KeyD","d"),new r.KeyboardKeyCode("KeyE","e"),new r.KeyboardKeyCode("KeyF","f"),new r.KeyboardKeyCode("KeyG","g"),new r.KeyboardKeyCode("KeyI","i"),new r.KeyboardKeyCode("KeyQ","q"),new r.KeyboardKeyCode("KeyR","r"),new r.KeyboardKeyCode("KeyS","s"),new r.KeyboardKeyCode("KeyT","t"),new r.KeyboardKeyCode("KeyV","v"),new r.KeyboardKeyCode("KeyW","w"),new r.KeyboardKeyCode("BracketLeft","["),new r.KeyboardKeyCode("BracketRight","]"),new r.KeyboardKeyCode("ArrowLeft","ArrowLeft",37,37),new r.KeyboardKeyCode("ArrowRight","ArrowRight",39,39),new r.KeyboardKeyCode("ArrowUp","ArrowUp",38,38),new r.KeyboardKeyCode("ArrowDown","ArrowDown",40,40),new r.KeyboardKeyCode("Digit0","0"),new r.KeyboardKeyCode("Digit1","1"),new r.KeyboardKeyCode("Digit2","2"),new r.KeyboardKeyCode("Digit3","3"),new r.KeyboardKeyCode("Digit4","4"),new r.KeyboardKeyCode("Digit5","5"),new r.KeyboardKeyCode("Digit6","6"),new r.KeyboardKeyCode("Digit7","7"),new r.KeyboardKeyCode("Digit8","8"),new r.KeyboardKeyCode("Digit9","9"),new r.KeyboardKeyCode("Numpad0","0"),new r.KeyboardKeyCode("Numpad1","1"),new r.KeyboardKeyCode("Numpad2","2"),new r.KeyboardKeyCode("Numpad3","3"),new r.KeyboardKeyCode("Numpad4","4"),new r.KeyboardKeyCode("Numpad5","5"),new r.KeyboardKeyCode("Numpad6","6"),new r.KeyboardKeyCode("Numpad7","7"),new r.KeyboardKeyCode("Numpad8","8"),new r.KeyboardKeyCode("Numpad9","9"),new r.KeyboardKeyCode("F8","F8");const i={DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"},n={COMMON:-1e4,SUCCESS:0,EXCEED_MAX_RETRY:1e4}},232:(e,t,o)=>{o.d(t,{D:()=>l});var r=o(903),i=o(882),n=o(613);const s={零:0,一:1,二:2,两:2,三:3,四:4,五:5,六:6,七:7,八:8,九:9,十:10,百:100,千:1e3,万:1e4,亿:1e8};function a(e,t){t.forEach((t=>{if(!(t instanceof Map))throw new TypeError("Source is not a map");t.forEach(((t,o)=>e.set(o,t)))}))}let l={consoleOutput(e=i.DEFAULT_LOG_GROUP,t=n.ConsoleOutputLevel.DEBUG,...o){console.group(`[${e}]`);let r=[];for(let e=0;e<o.length;e++){let t=o[e];r.push(l.isObject(t)&&t.toPlainObject?t.toPlainObject():t)}switch(t){case n.ConsoleOutputLevel.DEBUG:console.debug(...r);break;case n.ConsoleOutputLevel.INFO:console.info(...r);break;case n.ConsoleOutputLevel.LOG:console.log(...r);break;case n.ConsoleOutputLevel.WARN:console.warn(...r);break;case n.ConsoleOutputLevel.ERROR:console.error(...r);break;default:console.debug(...r)}console.groupEnd()},get:function(e,t,o){return new Promise(((r,i)=>{let n=new XMLHttpRequest;if(n.responseType=o||"json",n.addEventListener("load",(function(){r(this.response||this.responseText)})),n.addEventListener("error",(function(){i(this)})),n.open("GET",e),t)for(let e in t)n.setRequestHeader(e,t[e]);n.send()}))},post:function(e,t={"Content-Type":"application/x-www-form-urlencoded"},o,r){return new Promise(((i,n)=>{let s=new XMLHttpRequest;s.responseType=r||"json",s.addEventListener("load",(function(){i(this.response||this.responseText)})),s.addEventListener("error",(function(){n(this)})),s.open("POST",e);for(let e in t)s.setRequestHeader(e,t[e]);s.send(o)}))},getCookie:function(e){let t=document.cookie.replace(/\s/g,"").split(";");for(let o=0,r=t.length;o<r;o++){let r=t[o].split("=");if(r[0]==e)return decodeURIComponent(r[1])}return""},getQueryParameter:function(e,t=!1){let o=t?window.location.hash.replace(/#.*?\?/,"?"):window.location.search;for(let[t,r]of new URLSearchParams(o).entries())if(t===e)return r},isInteger:function(e){if(isNaN(e))return!1;let t=parseFloat(e);return(0|t)===t},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isZH:function(e){return/^[\u4e00-\u9fa5]+$/.test(e)},isChineseDigits:function(e){let t=Object.keys(s);for(const o of e)if(!t.includes(o))return!1;return!0},zh2Digits:function(e){if(l.isInteger(e))return parseInt(e);if(!this.isChineseDigits(e))return;let t=0,o=1;for(let r=e.length-1;r>=0;r--){let i=s[e[r]];i>=10&&0==r?i>o?(o=i,t+=i):o*=i:i>=10?i>o?o=i:o*=i:t+=o*i}return t},digits2ZH:function(e){if(this.isZH(e))return e;if(!l.isInteger(e))return;let t=["零","一","二","三","四","五","六","七","八","九","十","百","千","万","亿"],o=e.length;return 1==o?t[e]:2==o?10==e?t[e]:e>10&&e<20?"十"+t[e.charAt(1)]:t[e.charAt(0)]+"十"+t[e.charAt(1)].replace("零",""):void 0},isHttpSuccess:function(e){return!!e&&e>=200&&e<300},getFirstTruthyMember:function(e,t){let o;return e.some((e=>(o=t[e],!!o)))?o:void 0},isObject:function(e){return"[object Object]"===Object.prototype.toString.apply(e)||e instanceof Object},isString:function(e){return e instanceof String||"string"==typeof e},isBlank:function(e){return l.isString(e)?""===e.trim():null==e},assignNotUndefined:function(e,...t){return t.forEach((t=>{Object.keys(t).forEach((o=>{let r=t[o];void 0!==r&&(e[o]=r)}))})),e},assignNotEmpty:function(e,t,o=!1,r=!1){if(!Array.isArray(t))throw new TypeError("Invalid sources");if(!l.isObject(e))throw new TypeError("Invalid target");return e instanceof Map&&a(e,t),t.forEach((t=>{if(!l.isObject(t))throw new TypeError("Invalid source");Object.keys(t).forEach((i=>{let n=t[i],s=e[i];if(null!=n&&!Object.is(NaN,n))if(Array.isArray(s)){if(!Array.isArray(n))throw new TypeError(`${i} of source is not an array`);r?n.forEach((e=>{s.includes(e)||s.push(e)})):e[i]=n}else if(s instanceof Map)o?a(s,[n]):e[i]=n;else if(l.isObject(s)){if(!l.isObject(n))throw new TypeError(`${i} of source is not an object`);o?l.assignNotEmpty(s,[n],o,r):e[i]=n}else e[i]=n}))})),e},isIterable:function(e){return null!=e&&"function"==typeof e[Symbol.iterator]},isEqual:r._isEqual,formatDate:function(e,t="MM/dd/yyyy hh:mm:ss"){e instanceof Date||(e=new Date(e));var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[r]:("00"+o[r]).substr((""+o[r]).length)));return t},sleep:e=>new Promise((t=>setTimeout(t,e))),sleepUntil(e,t=window){let o=e-t.performance.now();return o>0?this.sleep(o):Promise.resolve()}}},719:(e,t,o)=>{o.d(t,{scriptName:()=>i});const r="undefined"==typeof GM_info?{name:"Tampermonkey"}:GM_info.script,i=r&&r.name},235:(e,t,o)=>{o.d(t,{EMOJIS:()=>r});const r={angry:[",,Ծ‸Ծ,,","(╯‵□′)╯︵┻━┻"],happy:["=‿=✧","●ω●","(/ ▽ \\)","(=・ω・=)","(●'◡'●)ﾉ♥","<(▰˘◡˘▰)>","(⁄ ⁄•⁄ω⁄•⁄ ⁄)","(ง,,• ᴗ •,,)ง ✧",">ㅂ<ﾉ ☆"],shock:["Σ( ° △ °|||)︴","┌( ಠ_ಠ)┘","(ﾟДﾟ≡ﾟдﾟ)!?","∑(っ °Д °;)っ"],sad:["＞︿＜","＞△＜","●︿●","(´；ω；`)"],helpless:["◐▽◑","ʅ（´◔౪◔）ʃ","_(:3 」∠)_","_(┐「ε:)_","(°▽°)ﾉ","←◡←","_(•̀ᴗ•́ 」∠ ❀)_","_φ(･ω･` )"],custom:["(`･ω･´)","(^_-)-☆","༼ つ ◕_◕ ༽つ","(☞ﾟヮﾟ)☞","( ͡° ͜ʖ ͡°)","(っ˘ڡ˘ς)","(⌐■_■)","( ͡~ ͜ʖ ͡°)","(╯°□°）╯︵ ┻━┻","(͡•_ ͡• )"]}},70:(e,t,o)=>{o.d(t,{D:()=>a});var r=o(719),i=o(235),n=o(232),s=o(613);const a={debug:function(...e){n.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.DEBUG,...e)},info:function(...e){n.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.INFO,...e)},log:function(...e){n.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.LOG,...e)},warn:function(...e){n.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.WARN,...e)},error:function(...e){n.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.ERROR,...e)},gmGet:function(e,t,o,r=!1){return new Promise(((i,n)=>{GM_xmlhttpRequest({method:"GET",url:e,headers:t,nocache:r,responseType:o||"json",onload:e=>{i(e.response||e.responseText)},onerror:e=>{n(e)}})}))},gmPost:function(e,t,o,r){return t=t||{"Content-Type":"application/x-www-form-urlencoded"},new Promise(((i,n)=>{GM_xmlhttpRequest({method:"POST",url:e,headers:t,data:o,responseType:r||"json",onload:e=>{i("blob"===r?e:e.response||e.responseText)},onerror:e=>{n(e)}})}))},gmOptions:function(e,t,o){return new Promise(((r,i)=>{GM_xmlhttpRequest({method:"OPTIONS",url:e,headers:t,responseType:o||"json",onload:e=>{r(e.response||e.responseText)},onerror:e=>{i(e)}})}))},printReceiveMessage:function(e){a.debug(`>>> From: ${e.origin}, To: ${window.location.origin}, Message:`,e.data)},printSendMessage:function(e,t){a.debug(`<<< To: ${e}, From: ${window.location.origin}, Message:`,t)},randomEmoji:{}};for(let e in i.EMOJIS)a.randomEmoji[e]=()=>i.EMOJIS[e][Math.floor(Math.random()*i.EMOJIS[e].length)]}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{o.r(r),o.d(r,{Utils:()=>e,util:()=>i});var e={};o.r(e),o.d(e,{BilibiliApiRequest:()=>d,BilibiliLiveApiRequest:()=>c,BilibiliUtils:()=>p});var t=o(232);const i={getBilibiliToken:function(){return t.D.getCookie("bili_jct")}};var n=o(903),s=o(613),a=o(70);async function l(e){const t=await e;if(0!==t.code)throw new n.CustomError(t.code,t.message);return t.data}class d{static#o(e,t){return t&&(e+="?"+t.toString()),a.D.gmGet(e)}static#r(e,t,o){return a.D.gmPost(e,t,o)}static getNotice(e){return l(this.#o(`https://api.bilibili.com/x/space/notice?mid=${e}&jsonp=jsonp`))}static getUserInfo(e){return l(this.#o(`https://api.bilibili.com/x/space/acc/info?mid=${e}&jsonp=jsonp`))}static getFollowings(e,t,o=50){return l(this.#o(`https://api.bilibili.com/x/relation/followings?vmid=${e}&pn=${t}&ps=${o}`))}static getNav(){return l(this.#o("https://api.bilibili.com/x/web-interface/nav"))}}class c{static#o(e,t){return t&&(e+="?"+t.toString()),a.D.gmGet(e)}static#r(e,t,o){return a.D.gmPost(e,t,o)}static getGiftConfig(e,t,o){let r=new URLSearchParams;return r.append("platform","pc"),r.append("room_id",e),r.append("area_parent_id",t),r.append("area_id",o),l(this.#o("https://api.live.bilibili.com/xlive/web-room/v1/giftPanel/giftConfig",r))}static getGiftBagList(e){let t=new URLSearchParams;return t.append("t",(new Date).getTime()),t.append("room_id",e),l(this.#o("https://api.live.bilibili.com/xlive/web-room/v1/gift/bag_list",t))}static sendBag(e,t,o,r,n,s,a){let d=i.getBilibiliToken(),c=new URLSearchParams;return c.append("uid",e),c.append("gift_id",t),c.append("ruid",o),c.append("send_ruid",0),c.append("gift_num",r),c.append("bag_id",n),c.append("platform","pc"),c.append("biz_code","Live"),c.append("biz_id",s),c.append("rnd",a),c.append("storm_beat_id",0),c.append("metadata",""),c.append("price",0),c.append("csrf_token",d),c.append("csrf",d),c.append("visit_id",""),l(this.#r("https://api.live.bilibili.com/xlive/revenue/v1/gift/sendBag",void 0,c.toString()))}static getWearedMedal(){return l(this.#o("https://api.live.bilibili.com/live_user/v1/UserInfo/get_weared_medal"))}static getMedalListInRoom(){return l(this.#o("https://api.live.bilibili.com/fans_medal/v1/FansMedal/get_list_in_room"))}static async#i(e){let t=1,o=0,r=[],i=0;do{let n=await l(this.#o(`https://api.live.bilibili.com/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=10&retry=${e}`));i=n.count,Array.isArray(n.items)&&n.items.forEach((e=>{let t=e;t.short_id=e.roomid,delete e.roomid,r.push(t)})),o=n.page_info.total_page,t++}while(t<=o);return new n.Couple(r,i)}static async getMedalCenterList(){let e=[],t=0,o=0,r=[];for(;o<=3;){let i=await this.#i(o);t=i[1];for(let o of i[0])if(!r.includes(o.target_id)&&(e.push(o),r.push(o.target_id),e.length==t))return e;o++}throw new n.CustomError(s.ErrorCode.EXCEED_MAX_RETRY,`超过最大重试次数，已获取${e.length}枚勋章，实际拥有${t}枚勋章`)}static wearMedal(e){if(!e)throw new n.CustomError(s.ErrorCode.COMMON,"Invalid medalId: "+e);let t=i.getBilibiliToken();if(!t)throw new n.CustomError(s.ErrorCode.COMMON,"Failed to get bilibili token");let o=new URLSearchParams;return o.append("medal_id",e),o.append("csrf_token",t),o.append("csrf",t),l(this.#r("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",void 0,o.toString()))}static getMedalExpectation(e,t,o,r){let i=new URLSearchParams;return i.append("target_id",e),i.append("price",o),i.append("coin_type",r),i.append("gift_id",t),i.append("platform","pc"),l(this.#o("https://api.live.bilibili.com/xlive/app-ucenter/v1/fansMedal/room",i.toString()))}static getBasicRoomInfos(e=[],t=[]){let o=new URLSearchParams;return e.forEach((e=>o.append("room_ids",e))),t.forEach((e=>o.append("uids",e))),o.append("req_biz","web_room_componet"),l(this.#o("https://api.live.bilibili.com/xlive/web-room/v1/index/getRoomBaseInfo",o))}static getRoomInfoByUser(e){return l(this.#o(`https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?room_id=${e}`))}static getRoomInfoByRoom(e){return l(this.#o(`https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByRoom?room_id=${e}`))}static sendDanmu(e,t,o,r=0,a=1,d=16777215){let c=i.getBilibiliToken();if(!c)throw new n.CustomError(s.ErrorCode.COMMON,"Failed to get bilibili token");let p={bubble:r,msg:e,color:d,mode:a,fontsize:25,rnd:t,roomid:o,csrf:c,csrf_token:c},u=new FormData;return Object.keys(p).forEach((e=>u.append(e,p[e]))),l(this.#r("https://api.live.bilibili.com/msg/send",{},u))}static getDanmuHistory(e){return l(this.#o(`https://api.live.bilibili.com/xlive/web-room/v1/dM/gethistory?roomid=${e}`))}static getWidgetBannerList(e){return l(this.#o(`https://api.live.bilibili.com/xlive/activity-interface/v1/widgetBanner/GetWidgetBannerList?room_id=${e}&platform=pc`))}}class p{static async getAnchorMedal(e){return(await c.getMedalExpectation(e,1,100,2)).current?.medal}static async getBasicRoomInfosByRoom(e){let t=[];do{t.push(e.splice(0,20))}while(e.length>0);let o=t.map((e=>c.getBasicRoomInfos(e)));return Promise.all(o).then((e=>{let t=new Map;return e.forEach((e=>{if(e.by_room_ids)for(let o in e.by_room_ids){let r=e.by_room_ids[o];r.short_id&&t.set(r.short_id,r),t.set(r.room_id,r)}})),t}))}static async getBasicRoomInfosByUser(e){return c.getBasicRoomInfos(void 0,e).then((e=>{let t=new Map;if(!e.by_uids)return t;for(let o in e.by_uids){let r=e.by_uids[o];t.set(r.uid,r)}return t}))}static async getExtendedMedalList(){let e=[],t=[];(await c.getMedalCenterList()).forEach((o=>{if(o.short_id)e.push(o);else{let e=o;e.short_id=e.roomid=0,t.push(e)}}));let o=await this.getBasicRoomInfosByRoom(e.map((e=>e.short_id)));return e.forEach((e=>{let r=e;r.roomid=o.get(e.short_id).room_id,t.push(r)})),t}static async isLiveEnabled(e){return 1==(await c.getRoomInfoByRoom(e)).new_switch_info?.["room-recommend-live_off"]}}})(),r})()}));