!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.bllib=t():e.bllib=t()}(self,(function(){return(()=>{"use strict";var e={903:(e,t,o)=>{function r(e,t){if(e instanceof Array){if(!(t instanceof Array)||e.length!=t.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],t[o]))return!1;return!0}return!!Object.is(e,t)||(e instanceof class{equals(e){return this===e}}?e.equals(t):e===t)}o.d(t,{CustomError:()=>i,KeyboardKeyCode:()=>n,_isEqual:()=>r});class n{code;key;constructor(e,t){this.code=e,this.key=t}}Map;class i extends Error{code;constructor(e,t){super(t),this.code=e}}},882:(e,t,o)=>{o.d(t,{DEFAULT_LOG_GROUP:()=>r});const r="Common"},613:(e,t,o)=>{o.d(t,{ConsoleOutputLevel:()=>n});var r=o(903);o(725),new r.KeyboardKeyCode("Space"," "),new r.KeyboardKeyCode("Enter","Enter"),new r.KeyboardKeyCode("Escape","Escape"),new r.KeyboardKeyCode("KeyC","c"),new r.KeyboardKeyCode("KeyD","d"),new r.KeyboardKeyCode("KeyF","f"),new r.KeyboardKeyCode("KeyG","g"),new r.KeyboardKeyCode("KeyI","i"),new r.KeyboardKeyCode("KeyQ","q"),new r.KeyboardKeyCode("KeyR","r"),new r.KeyboardKeyCode("KeyS","s"),new r.KeyboardKeyCode("KeyV","v"),new r.KeyboardKeyCode("KeyW","w"),new r.KeyboardKeyCode("BracketLeft","["),new r.KeyboardKeyCode("BracketRight","]"),new r.KeyboardKeyCode("ArrowLeft","ArrowLeft"),new r.KeyboardKeyCode("ArrowRight","ArrowRight"),new r.KeyboardKeyCode("ArrowUp","ArrowUp"),new r.KeyboardKeyCode("ArrowDown","ArrowDown"),new r.KeyboardKeyCode("Digit0","0"),new r.KeyboardKeyCode("Digit1","1"),new r.KeyboardKeyCode("Digit2","2"),new r.KeyboardKeyCode("Digit3","3"),new r.KeyboardKeyCode("Numpad0","0"),new r.KeyboardKeyCode("Numpad1","1"),new r.KeyboardKeyCode("Numpad2","2"),new r.KeyboardKeyCode("Numpad3","3"),new r.KeyboardKeyCode("Numpad4","4"),new r.KeyboardKeyCode("Numpad5","5"),new r.KeyboardKeyCode("Numpad6","6"),new r.KeyboardKeyCode("Numpad7","7"),new r.KeyboardKeyCode("Numpad8","8"),new r.KeyboardKeyCode("Numpad9","9"),new r.KeyboardKeyCode("F8","F8");const n={DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},232:(e,t,o)=>{o.d(t,{D:()=>d});var r=o(903),n=o(882),i=o(613);const s={零:0,一:1,二:2,两:2,三:3,四:4,五:5,六:6,七:7,八:8,九:9,十:10,百:100,千:1e3,万:1e4,亿:1e8};function a(e,t){t.forEach((t=>{if(!(t instanceof Map))throw new TypeError("Source is not a map");t.forEach(((t,o)=>e.set(o,t)))}))}let d={consoleOutput(e=n.DEFAULT_LOG_GROUP,t=i.ConsoleOutputLevel.DEBUG,...o){console.group(`[${e}]`);let r=[];for(let e=0;e<o.length;e++)r.push(d.isObject(o[e])?JSON.parse(JSON.stringify(o[e])):o[e]);switch(t){case i.ConsoleOutputLevel.DEBUG:console.debug(...r);break;case i.ConsoleOutputLevel.INFO:console.info(...r);break;case i.ConsoleOutputLevel.LOG:console.log(...r);break;case i.ConsoleOutputLevel.WARN:console.warn(...r);break;case i.ConsoleOutputLevel.ERROR:console.error(...r);break;default:console.debug(...r)}console.groupEnd()},get:function(e,t,o){return new Promise(((r,n)=>{let i=new XMLHttpRequest;if(i.responseType=o||"json",i.addEventListener("load",(function(){r(this.response||this.responseText)})),i.addEventListener("error",(function(){n(this)})),i.open("GET",e),t)for(let e in t)i.setRequestHeader(e,t[e]);i.send()}))},post:function(e,t={"Content-Type":"application/x-www-form-urlencoded"},o,r){return new Promise(((n,i)=>{let s=new XMLHttpRequest;s.responseType=r||"json",s.addEventListener("load",(function(){n(this.response||this.responseText)})),s.addEventListener("error",(function(){i(this)})),s.open("POST",e);for(let e in t)s.setRequestHeader(e,t[e]);s.send(o)}))},getCookie:function(e){let t=document.cookie.replace(/\s/g,"").split(";");for(let o=0,r=t.length;o<r;o++){let r=t[o].split("=");if(r[0]==e)return decodeURIComponent(r[1])}return""},getQueryParameter:function(e){for(let[t,o]of new URLSearchParams(window.location.search).entries())if(t===e)return o},isInteger:function(e){if(isNaN(e))return!1;let t=parseFloat(e);return(0|t)===t},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isZH:function(e){return/^[\u4e00-\u9fa5]+$/.test(e)},isChineseDigits:function(e){let t=Object.keys(s);for(const o of e)if(!t.includes(o))return!1;return!0},zh2Digits:function(e){if(d.isInteger(e))return parseInt(e);if(!this.isChineseDigits(e))return;let t=0,o=1;for(let r=e.length-1;r>=0;r--){let n=s[e[r]];n>=10&&0==r?n>o?(o=n,t+=n):o*=n:n>=10?n>o?o=n:o*=n:t+=o*n}return t},digits2ZH:function(e){if(this.isZH(e))return e;if(!d.isInteger(e))return;let t=["零","一","二","三","四","五","六","七","八","九","十","百","千","万","亿"],o=e.length;return 1==o?t[e]:2==o?10==e?t[e]:e>10&&e<20?"十"+t[e.charAt(1)]:t[e.charAt(0)]+"十"+t[e.charAt(1)].replace("零",""):void 0},isHttpSuccess:function(e){return!!e&&e>=200&&e<300},getFirstTruthyMember:function(e,t){let o;return e.some((e=>(o=t[e],!!o)))?o:void 0},isObject:function(e){return"[object Object]"===Object.prototype.toString.apply(e)||e instanceof Object},isString:function(e){return e instanceof String||"string"==typeof e},isBlank:function(e){return d.isString(e)?""===e.trim():null==e},assignNotUndefined:function(e,...t){return t.forEach((t=>{Object.keys(t).forEach((o=>{let r=t[o];void 0!==r&&(e[o]=r)}))})),e},assignNotEmpty:function(e,t,o=!1,r=!1){if(!Array.isArray(t))throw new TypeError("Invalid sources");if(!d.isObject(e))throw new TypeError("Invalid target");return e instanceof Map&&a(e,t),t.forEach((t=>{if(!d.isObject(t))throw new TypeError("Invalid source");Object.keys(t).forEach((n=>{let i=t[n],s=e[n];if(null!=i&&!Object.is(NaN,i))if(Array.isArray(s)){if(!Array.isArray(i))throw new TypeError(`${n} of source is not an array`);r?i.forEach((e=>{s.includes(e)||s.push(e)})):e[n]=i}else if(s instanceof Map)o?a(s,[i]):e[n]=i;else if(d.isObject(s)){if(!d.isObject(i))throw new TypeError(`${n} of source is not an object`);o?d.assignNotEmpty(s,[i],o,r):e[n]=i}else e[n]=i}))})),e},isIterable:function(e){return null!=e&&"function"==typeof e[Symbol.iterator]},isEqual:r._isEqual,formatDate:function(e,t="MM/dd/yyyy hh:mm:ss"){e instanceof Date||(e=new Date(e));var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[r]:("00"+o[r]).substr((""+o[r]).length)));return t},sleep:e=>new Promise((t=>setTimeout(t,e)))}},725:(e,t,o)=>{o.d(t,{EnumHelper:()=>n});var r=o(232);class n{static#e(e){if(!r.D.isObject(e))throw new TypeError("Parameter is not an enum")}static hasValue(e,t){this.#e(e);for(let o in e)if(r.D.isEqual(e[o],t))return!0;return!1}static toValueArray(e,t="string"){this.#e(e);let o=[];for(let r in e)typeof e[r]==t&&o.push(e[r]);return o}}},719:(e,t,o)=>{o.d(t,{scriptName:()=>n});const r="undefined"==typeof GM_info?{name:"Tampermonkey"}:GM_info.script,n=r&&r.name},235:(e,t,o)=>{o.d(t,{EMOJIS:()=>r});const r={angry:[",,Ծ‸Ծ,,","(╯‵□′)╯︵┻━┻"],happy:["=‿=✧","●ω●","(/ ▽ \\)","(=・ω・=)","(●'◡'●)ﾉ♥","<(▰˘◡˘▰)>","(⁄ ⁄•⁄ω⁄•⁄ ⁄)","(ง,,• ᴗ •,,)ง ✧",">ㅂ<ﾉ ☆"],shock:["Σ( ° △ °|||)︴","┌( ಠ_ಠ)┘","(ﾟДﾟ≡ﾟдﾟ)!?","∑(っ °Д °;)っ"],sad:["＞︿＜","＞△＜","●︿●","(´；ω；`)"],helpless:["◐▽◑","ʅ（´◔౪◔）ʃ","_(:3 」∠)_","_(┐「ε:)_","(°▽°)ﾉ","←◡←","_(•̀ᴗ•́ 」∠ ❀)_","_φ(･ω･` )"],custom:["(`･ω･´)","(^_-)-☆","༼ つ ◕_◕ ༽つ","(☞ﾟヮﾟ)☞","( ͡° ͜ʖ ͡°)","(っ˘ڡ˘ς)","(⌐■_■)","( ͡~ ͜ʖ ͡°)","(╯°□°）╯︵ ┻━┻","(͡•_ ͡• )"]}},70:(e,t,o)=>{o.d(t,{D:()=>a});var r=o(719),n=o(235),i=o(232),s=o(613);const a={debug:function(...e){i.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.DEBUG,...e)},error:function(...e){i.D.consoleOutput(r.scriptName,s.ConsoleOutputLevel.ERROR,...e)},gmGet:function(e,t,o,r=!1){return new Promise(((n,i)=>{GM_xmlhttpRequest({method:"GET",url:e,headers:t,nocache:r,responseType:o||"json",onload:e=>{n(e.response||e.responseText)},onerror:e=>{i(e)}})}))},gmPost:function(e,t,o,r){return t=t||{"Content-Type":"application/x-www-form-urlencoded"},new Promise(((n,i)=>{GM_xmlhttpRequest({method:"POST",url:e,headers:t,data:o,responseType:r||"json",onload:e=>{n("blob"===r?e:e.response||e.responseText)},onerror:e=>{i(e)}})}))},gmOptions:function(e,t,o){return new Promise(((r,n)=>{GM_xmlhttpRequest({method:"OPTIONS",url:e,headers:t,responseType:o||"json",onload:e=>{r(e.response||e.responseText)},onerror:e=>{n(e)}})}))},printReceiveMessage:function(e){a.debug(`>>> From: ${e.origin}, To: ${window.location.origin}, Message:`,e.data)},printSendMessage:function(e,t){a.debug(`<<< To: ${e}, From: ${window.location.origin}, Message:`,t)},randomEmoji:{}};for(let e in n.EMOJIS)a.randomEmoji[e]=()=>n.EMOJIS[e][Math.floor(Math.random()*n.EMOJIS[e].length)]}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{o.r(r),o.d(r,{Utils:()=>e,util:()=>n});var e={};o.r(e),o.d(e,{BilibiliApiRequest:()=>d,BilibiliLiveApiRequest:()=>l});var t=o(232);const n={getBilibiliToken:function(){return t.D.getCookie("bili_jct")}};var i=o(903),s=o(70);async function a(e){const t=await e;if(0!==t.code)throw new i.CustomError(t.code,t.message);return t.data}class d{static#t(e,t){return t&&(e+="?"+t.toString()),s.D.gmGet(e)}static#o(e,t,o){return s.D.gmPost(e,t,o)}static getNotice(e){return a(this.#t(`https://api.bilibili.com/x/space/notice?mid=${e}&jsonp=jsonp`))}}class l{static#t(e,t){return t&&(e+="?"+t.toString()),s.D.gmGet(e)}static#o(e,t,o){return s.D.gmPost(e,t,o)}static getGiftConfig(e,t,o){let r=new URLSearchParams;return r.append("platform","pc"),r.append("room_id",e),r.append("area_parent_id",t),r.append("area_id",o),a(this.#t("https://api.live.bilibili.com/xlive/web-room/v1/giftPanel/giftConfig",r))}static getGiftBagList(e){let t=new URLSearchParams;return t.append("t",(new Date).getTime()),t.append("room_id",e),a(this.#t("https://api.live.bilibili.com/xlive/web-room/v1/gift/bag_list",t))}static sendBag(e,t,o,r,n,i,s){let d=this.getToken(),l=new URLSearchParams;return l.append("uid",e),l.append("gift_id",t),l.append("ruid",o),l.append("send_ruid",0),l.append("gift_num",r),l.append("bag_id",n),l.append("platform","pc"),l.append("biz_code","Live"),l.append("biz_id",i),l.append("rnd",s),l.append("storm_beat_id",0),l.append("metadata",""),l.append("price",0),l.append("csrf_token",d),l.append("csrf",d),l.append("visit_id",""),a(this.#o("https://api.live.bilibili.com/xlive/revenue/v1/gift/sendBag",l.toString()))}static getWearedMedal(){return a(this.#t("https://api.live.bilibili.com/live_user/v1/UserInfo/get_weared_medal"))}static getMedalListInRoom(){return a(this.#t("https://api.live.bilibili.com/fans_medal/v1/FansMedal/get_list_in_room"))}static async getMedalCenterList(){let e=1,t=0,o=[];do{let r=await a(this.#t(`https://api.live.bilibili.com/xlive/app-ucenter/v1/user/GetMyMedals?page=${e}&page_size=10`));Array.isArray(r.items)&&(o=o.concat(r.items)),t=r.page_info.total_page,e++}while(e<=t);return o}static wearMedal(e){if(!e)throw"invalid medalId: "+e;let t=n.getBilibiliToken();if(!t)throw new Error("Failed to get bilibili token");let o=new URLSearchParams;return o.append("medal_id",e),o.append("csrf_token",t),o.append("csrf",t),a(this.#o("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",o.toString()))}static getMedalExpectation(e,t,o,r){let n=new URLSearchParams;return n.append("target_id",e),n.append("price",o),n.append("coin_type",r),n.append("gift_id",t),n.append("platform","pc"),a(this.#t("https://api.live.bilibili.com/xlive/app-ucenter/v1/fansMedal/room",n.toString()))}static getUserInfo(e){return a(this.#t(`https://api.bilibili.com/x/space/acc/info?mid=${e}&jsonp=jsonp`))}static getFollowings(e,t,o=50){return a(this.#t(`https://api.bilibili.com/x/relation/followings?vmid=${e}&pn=${t}&ps=${o}`))}static getNav(){return a(this.#t("https://api.bilibili.com/x/web-interface/nav"))}static getBasicRoomInfo(e){return a(this.#t(`https://api.live.bilibili.com/xlive/web-room/v1/index/getRoomBaseInfo?room_ids=${e}&req_biz=web_room_componet`))}static getInfoByRoom(e){return a(this.#t(`https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?room_id=${e}`))}static sendDanmu(e,t,o){let r=n.getBilibiliToken();if(!r)throw new Error("Failed to get bilibili token");let i={bubble:0,msg:e,color:5566168,mode:1,fontsize:25,rnd:t,roomid:o,csrf:r,csrf_token:r},s=new FormData;return Object.keys(i).forEach((e=>s.append(e,i[e]))),a(this.#o("https://api.live.bilibili.com/msg/send",{},s))}}})(),r})()}));